import os
import requests
import asyncio
from datetime import datetime
from telegram import Bot
import random
import traceback
import re

class FreeAITechAgent:
    def __init__(self):
        self.bot = Bot(token=os.environ["TELEGRAM_BOT_TOKEN"])
        self.channel_id = os.environ["TELEGRAM_CHANNEL_ID"]
        self.unsplash_key = os.environ["UNSPLASH_ACCESS_KEY"]
        self.reddit_headers = {"User-agent": "AITechBot/1.0 (by /u/ai_digest_bot)"}
    
    async def fetch_reddit_posts(self):
        """–ü–∞—Ä—Å–∏–º –Ω–∏—à–µ–≤—ã–µ —Å–∞–±—Ä–µ–¥–¥–∏—Ç—ã ‚Äî —Ä–µ–∞–ª—å–Ω—ã–µ –∫–µ–π—Å—ã –æ—Ç –ª—é–¥–µ–π"""
        posts = []
        subreddits = [
            ("r/StableDiffusion", "–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π"),
            ("r/Midjourney", "–ø—Ä–æ–º–ø—Ç—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã"),
            ("r/sidehustle", "–∑–∞—Ä–∞–±–æ—Ç–æ–∫ –±–µ–∑ –≤–ª–æ–∂–µ–Ω–∏–π"),
            ("r/PassiveIncome", "–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –¥–æ—Ö–æ–¥–∞"),
            ("r/SideProject", "—Ñ–∞–±—Ä–∏–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞"),
            ("r/LocalLLaMA", "–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏"),
            ("r/Proton", "–æ–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫"),
            ("r/privacy", "–∞–Ω–æ–Ω–∏–º–Ω–∞—è –æ–ø–ª–∞—Ç–∞")
        ]
        
        for subreddit, niche in random.sample(subreddits, 4):  # –ë–µ—Ä—ë–º 4 —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–∞–±—Ä–µ–¥–¥–∏—Ç–∞
            try:
                url = f"https://www.reddit.com/{subreddit}/top.json?t=week&limit=5"
                response = requests.get(url, headers=self.reddit_headers, timeout=12)
                data = response.json()
                
                for post in data["data"]["children"]:
                    title = post["data"]["title"]
                    score = post["data"]["score"]
                    # –§–∏–ª—å—Ç—Ä—É–µ–º —Å–ø–∞–º –∏ –Ω–∏–∑–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
                    if score < 50:  # –¢–æ–ª—å–∫–æ –ø–æ—Å—Ç—ã —Å 50+ –∞–ø–≤–æ–π—Ç–∞–º–∏
                        continue
                    if any(word in title.lower() for word in ["crypto", "nft", "bitcoin", "doge", "get rich quick"]):
                        continue
                    if len(title) < 30 or len(title) > 200:
                        continue
                    posts.append({
                        "title": title,
                        "subreddit": subreddit,
                        "score": score,
                        "url": post["data"]["url"],
                        "niche": niche
                    })
            except Exception as e:
                print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ {subreddit}: {e}")
                continue
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É –∏ –±–µ—Ä—ë–º —Ç–æ–ø-8
        posts.sort(key=lambda x: x["score"], reverse=True)
        return posts[:8]
    
    async def generate_text(self, reddit_posts=None):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫–µ–π—Å–∞–º–∏ –∏–∑ —Ñ–æ—Ä—É–º–æ–≤"""
        
        # –ú–æ—â–Ω—ã–µ —Ç–µ–º—ã –ø–æ–¥ –≤–∞—à—É –Ω–∏—à—É
        topics = [
            "—Ñ–∞–±—Ä–∏–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–∞ –ò–ò: –∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞ 1 –¥–µ–Ω—å",
            "–∫–∞–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å $1000/–º–µ—Å –Ω–∞ –ø—Ä–æ–¥–∞–∂–µ –ø—Ä–æ–º–ø—Ç–æ–≤",
            "–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –≤–∏–¥–µ–æ –≤–º–µ—Å—Ç–æ –¥–æ—Ä–æ–≥–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫",
            "–∫–∞–∫ –æ–±–æ–π—Ç–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –ò–ò-—Å–µ—Ä–≤–∏—Å–æ–≤ –≤ –†–æ—Å—Å–∏–∏ (—Ä–∞–±–æ—á–∏–µ —Å–ø–æ—Å–æ–±—ã)",
            "–∫–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å –∑–∞—Ä—É–±–µ–∂–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –±–µ–∑ –∫–∞—Ä—Ç—ã –†–§",
            "–∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –ø–ª–∞—Ç–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É –±–µ—Å–ø–ª–∞—Ç–Ω–æ (–ª–µ–≥–∞–ª—å–Ω—ã–µ —Å—Ö–µ–º—ã)",
            "—Å–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç –±–µ–∑ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞: –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã",
            "–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: 1000 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π/–¥–µ–Ω—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ",
            "—Ä–µ–∞–ª—å–Ω—ã–π –∫–µ–π—Å: –∑–∞—Ä–∞–±–æ—Ç–∞–ª $2300 –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞",
            "—Å–∫—Ä—ã—Ç—ã–µ —Ñ–∏—á–∏ —Å–µ—Ä–≤–∏—Å–æ–≤, –æ –∫–æ—Ç–æ—Ä—ã—Ö –º–æ–ª—á–∞—Ç –≤—Å–µ –≥—É—Ä—É",
            "–∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∑–∞–∫—Ä—ã—Ç—ã–º –±–µ—Ç–∞-—Ç–µ—Å—Ç–∞–º –ò–ò",
            "—Ñ–∞–±—Ä–∏–∫–∞ –º–µ–º–æ–≤: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏—Ä—É—Å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞",
            "–∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ò–ò —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏",
            "–ø–∞—Ä—Ç–Ω—ë—Ä–∫–∏ –ò–ò-—Å–µ—Ä–≤–∏—Å–æ–≤: —Å–∫–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω–æ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç",
            "–∫–∞–∫ –ø—Ä–æ–¥–∞–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ –ø—Ä–æ–º–ø—Ç—ã –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞—Ö"
        ]
        topic = random.choice(topics)
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ —Å–∞–±—Ä–µ–¥–¥–∏—Ç–æ–≤ (—Ä–µ–∞–ª—å–Ω—ã–µ –∫–µ–π—Å—ã)
        reddit_context = ""
        if reddit_posts:
            top_posts = reddit_posts[:4]
            reddit_context = "–†–µ–∞–ª—å–Ω—ã–µ –∫–µ–π—Å—ã —Å —Ñ–æ—Ä—É–º–æ–≤:\n" + "\n".join([
                f"‚Ä¢ {post['title']} ({post['subreddit']}, {post['score']}‚Üë)"
                for post in top_posts
            ])
        
        prompt = f"""–¢—ã ‚Äî –∏–Ω—Å–∞–π–¥–µ—Ä –∏–Ω–¥—É—Å—Ç—Ä–∏–∏ –ò–ò. –ü–∏—à–µ—à—å –∫–æ—Ä–æ—Ç–∫–∏–µ, –º–æ—â–Ω—ã–µ –ø–æ—Å—Ç—ã –¥–ª—è —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω–æ–≥–æ Telegram-–∫–∞–Ω–∞–ª–∞.

–¢–µ–º–∞: {topic}

{reddit_context}

–ü—Ä–∞–≤–∏–ª–∞ –°–¢–†–û–ì–û:
‚úÖ –¢–û–ù: –∫–∞–∫ –∏–Ω—Å–∞–π–¥–µ—Ä –¥–µ–ª–∏—Ç—Å—è –∑–∞–∫—Ä—ã—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π. –ë–µ–∑ –≤–æ–¥—ã. –ë–µ–∑ —Ñ–∞–ª—å—à–∏–≤–æ–≥–æ —Å–ª–µ–Ω–≥–∞ ("–±—Ä–∞—Ç–∞–Ω", "—á—É–≤–∞–∫" ‚Äî –ó–ê–ü–†–ï–©–ï–ù–û). –ë–µ–∑ —Å–ª–æ–≤–∞ "–ª–∞–π—Ñ—Ö–∞–∫".
‚úÖ –î–õ–ò–ù–ê: 90-160 —Å–ª–æ–≤. –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ = —Ü–µ–Ω–Ω–æ—Å—Ç—å.
‚úÖ –°–¢–†–£–ö–¢–£–†–ê:
   - –ó–∞–≥–æ–ª–æ–≤–æ–∫-–±–æ–º–±–∞ —Å —ç–º–æ–¥–∑–∏ (üí•/üî•/‚ö°/üöÄ/üí∞/ü§Ø)
   - 1 —Å—Ç—Ä–æ–∫–∞ ‚Äî –ø—Ä–æ–≤–æ–∫–∞—Ü–∏—è ("–ó–∞–±—É–¥—å –ø—Ä–æ $10 –ø–æ–¥–ø–∏—Å–∫–∏")
   - 3-5 –ø—É–Ω–∫—Ç–æ–≤ —Å –≠–ú–û–î–ó–ò –≤ –Ω–∞—á–∞–ª–µ (üí∏ üé• ü§Ø üöÄ ‚ö° üî•)
   - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã + —Ü–∏—Ñ—Ä—ã –¥–æ—Ö–æ–¥–∞/—Å—Ç–æ–∏–º–æ—Å—Ç–∏
   - –ö–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –≤ –∫–æ–Ω—Ü–µ (–∫–æ—Ä–æ—Ç–∫–∞—è, –±–µ–∑ —Å–∫–æ–±–æ–∫)
‚úÖ –ö–õ–Æ–ß–ï–í–´–ï –°–õ–û–í–ê –≤–º–µ—Å—Ç–æ "–ª–∞–π—Ñ—Ö–∞–∫":
   - "—Å—Ö–µ–º–∞", "—Ñ–æ–∫—É—Å", "—Ñ–∏—à–∫–∞", "–ø—Ä–∏—ë–º", "–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è", "–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ"
‚úÖ –¢–ï–ú–ê–¢–ò–ö–ê:
   - –§–∞–±—Ä–∏–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–∞ –ò–ò (–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏)
   - –ó–∞—Ä–∞–±–æ—Ç–æ–∫ –Ω–∞ –ø—Ä–æ–º–ø—Ç–∞—Ö (—Ä–µ–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã $300-2000/–º–µ—Å)
   - –û–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –≤ –†–æ—Å—Å–∏–∏ (–ø—Ä–æ–∫—Å–∏, –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –¥–æ–º–µ–Ω—ã)
   - –û–ø–ª–∞—Ç–∞ –±–µ–∑ –∫–∞—Ä—Ç—ã –†–§ (–∫—Ä–∏–ø—Ç–æ, –ø–æ–¥–∞—Ä–æ—á–Ω—ã–µ –∫–∞—Ä—Ç—ã, –∫–∏–≤–∏)
   - –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ (–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã, –±–µ—Ç–∞-—Ç–µ—Å—Ç—ã)
   - –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã (—Å–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –±–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞)
‚úÖ –°–°–´–õ–ö–ò:
   - –î–µ–ª–∞–π –∏—Ö –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º–∏: –∫–æ—Ä–æ—Ç–∫–∏–µ, –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
   - –ü—Ä–∏–º–µ—Ä: "https://leonardo.ai" –≤–º–µ—Å—Ç–æ "[—Å—Å—ã–ª–∫–∞](https://leonardo.ai)"
‚úÖ –ó–ê–ü–†–ï–©–ï–ù–û:
   - "–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: —Ñ–µ–≤—Ä–∞–ª—å 2026" –∏–ª–∏ –ª—é–±—ã–µ –¥–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏
   - –°–ª–æ–≤–æ "–ª–∞–π—Ñ—Ö–∞–∫"
   - –î–ª–∏–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (>15 —Å–ª–æ–≤)
   - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ **–∂–∏—Ä–Ω—ã–π** –∏–ª–∏ _–∫—É—Ä—Å–∏–≤_
   - –°–ø–∞–º, –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–± –∑–∞—Ä–∞–±–æ—Ç–∫–∞

–ü–†–ò–ú–ï–† –ò–î–ï–ê–õ–¨–ù–û–ì–û –ü–û–°–¢–ê:
üí• –§–∞–±—Ä–∏–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–∞ –ò–ò: $1200/–º–µ—Å

–ó–∞–±—É–¥—å –ø—Ä–æ —Ä—É—á–Ω—É—é —Ä–∞–±–æ—Ç—É.

üí∏ –ü—Ä–æ–¥–∞–≤–∞–π –ø—Ä–æ–º–ø—Ç—ã –Ω–∞ PromptBase ($3-7 –∑–∞ —à—Ç—É–∫—É)
üé• –ì–µ–Ω–µ—Ä–∏—Ä—É–π 50 –≤–∏–¥–µ–æ/–¥–µ–Ω—å —á–µ—Ä–µ–∑ Pika + CapCut
üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–π –ø–æ—Å—Ç—ã —á–µ—Ä–µ–∑ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç
ü§Ø –ú–æ–π –∑–Ω–∞–∫–æ–º—ã–π –≤—ã—à–µ–ª –Ω–∞ $1200/–º–µ—Å –∑–∞ 3 –Ω–µ–¥–µ–ª–∏

–°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –±–µ–∑ –æ–ø—ã—Ç–∞.

https://promptbase.com"""

        print(f"üß† –ì–µ–Ω–µ—Ä–∏—Ä—É—é –ø–æ—Å—Ç –Ω–∞ —Ç–µ–º—É: {topic}")
        if reddit_posts:
            print(f"üìä –ò—Å–ø–æ–ª—å–∑—É—é {len(reddit_posts)} —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –∏–∑ —Å–∞–±—Ä–µ–¥–¥–∏—Ç–æ–≤")
        
        try:
            response = requests.post(
                "https://api.groq.com/openai/v1/chat/completions",
                headers={
                    "Authorization": f"Bearer {os.environ['GROQ_API_KEY']}",
                    "Content-Type": "application/json"
                },
                json={
                    "model": "llama-3.1-8b-instant",
                    "messages": [{"role": "user", "content": prompt}],
                    "max_tokens": 450,
                    "temperature": 0.95  # –ë–æ–ª—å—à–µ –∫—Ä–µ–∞—Ç–∏–≤–∞ –¥–ª—è "–∏–Ω—Å–∞–π–¥–µ—Ä—Å–∫–æ–≥–æ" —Å—Ç–∏–ª—è
                },
                timeout=35
            )
            
            if response.status_code != 200:
                print(f"‚ùå Groq error {response.status_code}")
                return self._fallback_post()
            
            text = response.json()["choices"][0]["message"]["content"]
            return self._clean_text(text)
            
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: {e}")
            return self._fallback_post()
    
    def _clean_text(self, text):
        """–ß–∏—Å—Ç–∏–º —Ç–µ–∫—Å—Ç –æ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤"""
        # –£–±–∏—Ä–∞–µ–º "–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ", –¥–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏
        text = re.sub(r'–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ[:\s]*[–∞-—è–ê-–Ø0-9\s]+202[0-9]', '', text)
        text = re.sub(r'–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ[:\s]*[–∞-—è–ê-–Ø0-9\s]+202[0-9]', '', text)
        # –£–±–∏—Ä–∞–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        text = text.replace("**", "").replace("__", "").replace("```", "")
        # –ß–∏—Å—Ç–∏–º —Å—Å—ã–ª–∫–∏
        if "](" in text:
            try:
                link = text.split("](")[-1].split(")")[0].strip()
                text_before = text.split("[")[0].strip()
                text = text_before + "\n\n" + link
            except:
                pass
        # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
        lines = [line.rstrip() for line in text.split("\n") if line.strip()]
        return "\n".join(lines[:14])  # –ú–∞–∫—Å 14 —Å—Ç—Ä–æ–∫
    
    def _validate_post(self, text):
        """–°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞"""
        checks = {
            "min_length": len(text) >= 90,
            "max_length": len(text) <= 500,
            "has_power_emoji": bool(re.search(r'[üí•üî•üöÄüí∞ü§Ø‚ö°]', text)),
            "has_bullet_points": text.count('\n') >= 4,
            "no_banned_words": "–ª–∞–π—Ñ—Ö–∞–∫" not in text.lower() and "–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ" not in text.lower(),
            "has_url": bool(re.search(r'https?://[^\s]+', text)),
            "no_fake_slang": "–±—Ä–∞—Ç–∞–Ω" not in text.lower() and "—á—É–≤–∞–∫" not in text.lower(),
            "has_numbers": bool(re.search(r'\$?\d{2,}', text))  # –ï—Å—Ç—å —Ü–∏—Ñ—Ä—ã ($500, 100 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
        }
        
        failed_checks = [k for k, v in checks.items() if not v]
        
        if failed_checks:
            print(f"‚ö†Ô∏è –ü–æ—Å—Ç –Ω–µ –ø—Ä–æ—à—ë–ª –ø—Ä–æ–≤–µ—Ä–∫—É: {', '.join(failed_checks)}")
            return False
        else:
            print("‚úÖ –ü–æ—Å—Ç –ø—Ä–æ—à—ë–ª –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏")
            return True
    
    def _fallback_post(self):
        """–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Ö–æ—Ä–æ—à–∏–π –ø–æ—Å—Ç"""
        return """üí• –§–∞–±—Ä–∏–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–∞ –ò–ò: $800/–º–µ—Å

–ó–∞–±—É–¥—å –ø—Ä–æ —Ä—É—á–Ω—É—é —Ä–∞–±–æ—Ç—É.

üí∏ –ü—Ä–æ–¥–∞–≤–∞–π –ø—Ä–æ–º–ø—Ç—ã –Ω–∞ PromptBase ($3-7 –∑–∞ —à—Ç—É–∫—É)
üé• –ì–µ–Ω–µ—Ä–∏—Ä—É–π 50 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π/–¥–µ–Ω—å —á–µ—Ä–µ–∑ Leonardo.ai
üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–π —á–µ—Ä–µ–∑ –ø—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç
ü§Ø –†–µ–∞–ª—å–Ω—ã–π –∫–µ–π—Å: $837 –∑–∞ –ø–µ—Ä–≤—ã–π –º–µ—Å—è—Ü

–°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ–ø—ã—Ç–∞.

https://promptbase.com"""
    
    async def get_image(self):
        """–†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ ‚Äî –Ω–∏–∫–∞–∫–∏—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π"""
        queries = [
            "ai content factory", "digital automation", "content creation workflow",
            "online income stream", "passive income laptop", "side hustle automation",
            "neural network art generation", "ai video production", "digital creator tools",
            "futuristic technology interface", "data visualization abstract", "creative coding"
        ]
        query = random.choice(queries)
        
        try:
            print(f"üñºÔ∏è –ó–∞–ø—Ä–æ—Å –∫ Unsplash: '{query}'")
            img = requests.get(
                "https://api.unsplash.com/photos/random",
                params={
                    "query": query,
                    "orientation": "landscape",
                    "client_id": self.unsplash_key
                },
                timeout=10
            ).json()
            return img["urls"]["regular"]
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ Unsplash: {e}")
            return "https://images.unsplash.com/photo-1677234558153-bf5ce094bad4?w=1200&h=630&fit=crop"
    
    async def publish(self):
        print(f"üöÄ –ó–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞: {datetime.now()}")
        
        try:
            # 1. –ü–∞—Ä—Å–∏–º —Å–∞–±—Ä–µ–¥–¥–∏—Ç—ã –∑–∞ —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫–µ–π—Å–∞–º–∏
            print("üì° –°–æ–±–∏—Ä–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –∫–µ–π—Å—ã —Å —Ñ–æ—Ä—É–º–æ–≤...")
            reddit_posts = await self.fetch_reddit_posts()
            print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(reddit_posts)} –∫–µ–π—Å–æ–≤ (–º–∏–Ω. 50‚Üë –∞–ø–≤–æ–π—Ç–æ–≤)")
            
            # 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç
            text = await self.generate_text(reddit_posts)
            print(f"‚úÖ –¢–µ–∫—Å—Ç:\n---\n{text}\n---")
            
            # 3. –°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞
            if not self._validate_post(text):
                print("‚ö†Ô∏è –ü–æ—Å—Ç –Ω–µ –ø—Ä–æ—à—ë–ª –ø—Ä–æ–≤–µ—Ä–∫—É ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é —Ñ–æ–ª–±—ç–∫")
                text = self._fallback_post()
            
            # 4. –ö–∞—Ä—Ç–∏–Ω–∫–∞
            image_url = await self.get_image()
            print(f"üñºÔ∏è –ö–∞—Ä—Ç–∏–Ω–∫–∞: {image_url[:60]}")
            
            # 5. –ü—É–±–ª–∏–∫–∞—Ü–∏—è
            await self.bot.send_photo(
                chat_id=self.channel_id,
                photo=image_url
            )
            await asyncio.sleep(1)
            await self.bot.send_message(
                chat_id=self.channel_id,
                text=text,
                parse_mode=None
            )
            print(f"‚úÖ –ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –≤ {self.channel_id}")
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
            print(traceback.format_exc())
            await self.bot.send_message(
                chat_id=self.channel_id,
                text=self._fallback_post(),
                parse_mode=None
            )
            print("‚úÖ –§–æ–ª–±—ç–∫ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω")

if __name__ == "__main__":
    asyncio.run(FreeAITechAgent().publish())
