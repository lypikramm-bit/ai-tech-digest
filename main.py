import os
import requests
import asyncio
from datetime import datetime
from telegram import Bot
import random
import traceback
import re

class FreeAITechAgent:
    def __init__(self):
        self.bot = Bot(token=os.environ["TELEGRAM_BOT_TOKEN"])
        self.channel_id = os.environ["TELEGRAM_CHANNEL_ID"]
        self.unsplash_key = os.environ["UNSPLASH_ACCESS_KEY"]
        self.reddit_headers = {"User-agent": "AITechBot/1.0 (by /u/your_username)"}
    
    async def fetch_reddit_posts(self):
        """–ü–∞—Ä—Å–∏–º —Å–∞–±—Ä–µ–¥–¥–∏—Ç—ã ‚Äî —Å–≤–µ–∂–∏–µ –∏–¥–µ–∏ –æ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –ª—é–¥–µ–π"""
        posts = []
        subreddits = [
            "r/StableDiffusion",
            "r/Midjourney",
            "r/sidehustle",
            "r/ArtificialIntelligence",
            "r/LocalLLaMA"
        ]
        
        for subreddit in subreddits[:3]:  # –ë–µ—Ä—ë–º 3 —Å–∞–±—Ä–µ–¥–¥–∏—Ç–∞ –∑–∞ —Ä–∞–∑ (–±–µ–∑ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏)
            try:
                url = f"https://www.reddit.com/{subreddit}/top.json?t=day&limit=3"
                response = requests.get(url, headers=self.reddit_headers, timeout=10)
                data = response.json()
                
                for post in data["data"]["children"][:2]:  # 2 –ø–æ—Å—Ç–∞ —Å –∫–∞–∂–¥–æ–≥–æ —Å–∞–±—Ä–µ–¥–¥–∏—Ç–∞
                    title = post["data"]["title"]
                    # –§–∏–ª—å—Ç—Ä—É–µ–º —Å–ø–∞–º –∏ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–µ
                    if any(word in title.lower() for word in ["crypto", "nft", "bitcoin", "dogecoin", "meme stock"]):
                        continue
                    if len(title) < 20 or len(title) > 150:
                        continue
                    posts.append({
                        "title": title,
                        "subreddit": subreddit,
                        "url": post["data"]["url"]
                    })
            except Exception as e:
                print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ {subreddit}: {e}")
                continue
        
        return posts[:6]  # –ú–∞–∫—Å–∏–º—É–º 6 –ø–æ—Å—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
    
    async def generate_text(self, reddit_posts=None):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ—Å—Ç —Å —É—á—ë—Ç–æ–º —Å–≤–µ–∂–∏—Ö –∏–¥–µ–π –∏–∑ —Å–∞–±—Ä–µ–¥–¥–∏—Ç–æ–≤"""
        
        # –¢–µ–º—ã –ø–æ–¥ –≤–∞—à—É –Ω–∏—à—É (–≤–∫–ª—é—á–∞—è –æ–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏ –ª–∞–π—Ñ—Ö–∞–∫–∏)
        topics = [
            "–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –≤–∏–¥–µ–æ –ò–ò –≤–º–µ—Å—Ç–æ –¥–æ—Ä–æ–≥–∏—Ö",
            "–∫–∞–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –ø—Ä–æ–¥–∞–∂–µ –ø—Ä–æ–º–ø—Ç–æ–≤ –≤ 2026",
            "–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∞–Ω–∞–ª–æ–≥–∏ Midjourney –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç",
            "–∫–∞–∫ –æ–±–æ–π—Ç–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –ò–ò-—Å–µ—Ä–≤–∏—Å–æ–≤ –≤ –†–æ—Å—Å–∏–∏",
            "–∫–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å –∑–∞—Ä—É–±–µ–∂–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –±–µ–∑ –∫–∞—Ä—Ç—ã –†–§",
            "–∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –ø–ª–∞—Ç–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É –±–µ—Å–ø–ª–∞—Ç–Ω–æ (–ª–µ–≥–∞–ª—å–Ω–æ)",
            "–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –ª–∞–π—Ñ—Ö–∞–∫: —Å–æ–∑–¥–∞—Ç—å –ì—É–≥–ª –∞–∫–∫–∞—É–Ω—Ç –±–µ–∑ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞",
            "–∫–∞–∫ –±–µ—Å–ø–ª–∞—Ç–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å 100+ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –¥–µ–Ω—å",
            "—Ä–µ–∞–ª—å–Ω—ã–π –∫–µ–π—Å: –∑–∞—Ä–∞–±–æ—Ç–∞–ª $500 –Ω–∞ –ø—Ä–æ–º–ø—Ç–∞—Ö –∑–∞ –º–µ—Å—è—Ü",
            "—Å–∫—Ä—ã—Ç—ã–µ —Ñ–∏—á–∏ Leonardo.ai –∏ Playground AI",
            "–∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –≤–∏—Ä—É—Å–Ω—ã–π –º–µ–º –∑–∞ 60 —Å–µ–∫—É–Ω–¥ —Å –ò–ò",
            "–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏",
            "–∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ò–ò —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ –≤ –†–æ—Å—Å–∏–∏",
            "–∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∑–∞–∫—Ä—ã—Ç—ã–º –±–µ—Ç–∞-—Ç–µ—Å—Ç–∞–º –ò–ò",
            "–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–±: –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –∫—Ä–∏–ø—Ç–æ –±–µ–∑ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏"
        ]
        topic = random.choice(topics)
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ —Å–∞–±—Ä–µ–¥–¥–∏—Ç–æ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å)
        reddit_context = ""
        if reddit_posts:
            reddit_context = "\n–°–≤–µ–∂–∏–µ –∏–¥–µ–∏ –∏–∑ —Å–∞–±—Ä–µ–¥–¥–∏—Ç–æ–≤:\n" + "\n".join([
                f"- {post['title']} ({post['subreddit']})"
                for post in reddit_posts[:3]
            ])
        
        prompt = f"""–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ò–ò, –∫–æ—Ç–æ—Ä—ã–π –ø–∏—à–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–µ, –∂–∏–≤—ã–µ –ø–æ—Å—Ç—ã –¥–ª—è —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω–æ–≥–æ Telegram-–∫–∞–Ω–∞–ª–∞.

–¢–µ–º–∞ –ø–æ—Å—Ç–∞: {topic}

{reddit_context}

–ü—Ä–∞–≤–∏–ª–∞ –°–¢–†–û–ì–û:
‚úÖ –¢–û–ù: —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π, –∫–∞–∫ —É–º–Ω—ã–π –¥—Ä—É–≥ –¥–µ–ª–∏—Ç—Å—è –ª–∞–π—Ñ—Ö–∞–∫–æ–º. –ù–ò–ö–ê–ö–û–ì–û —Ñ–∞–ª—å—à–∏–≤–æ–≥–æ —Å–ª–µ–Ω–≥–∞ ("–±—Ä–∞—Ç–∞–Ω", "—á—É–≤–∞–∫" ‚Äî –ó–ê–ü–†–ï–©–ï–ù–û).
‚úÖ –î–õ–ò–ù–ê: 80-150 —Å–ª–æ–≤. –ù–ò–ö–ê–ö–û–ô –í–û–î–´. –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ = –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –ø–æ–ª—å–∑–∞.
‚úÖ –°–¢–†–£–ö–¢–£–†–ê:
   - –ó–∞–≥–æ–ª–æ–≤–æ–∫-–∫–ª–∏–ø–±–µ–π—Ç —Å —ç–º–æ–¥–∑–∏ (üí∏/üî•/‚ö°/ü§ñ/üé®/üí∞)
   - 1 —Å—Ç—Ä–æ–∫–∞ ‚Äî –±–æ–ª—å ("–ü–ª–∞—Ç–∏—à—å $10 –∑–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é?")
   - 3-5 –ø—É–Ω–∫—Ç–æ–≤ —Å –≠–ú–û–î–ó–ò –≤ –Ω–∞—á–∞–ª–µ (üí∞ üé• ü§Ø üöÄ ‚ö° üî•)
   - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ + —Ü–µ–Ω—ã –≤ —Ä—É–±–ª—è—Ö/–¥–æ–ª–ª–∞—Ä–∞—Ö
   - –°—Å—ã–ª–∫–∞ –≤ –∫–æ–Ω—Ü–µ (—á–∏—Å—Ç—ã–π URL –±–µ–∑ —Å–∫–æ–±–æ–∫)
‚úÖ –¢–ï–ú–ê–¢–ò–ö–ê:
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã)
   - –ó–∞—Ä–∞–±–æ—Ç–æ–∫ –Ω–∞ –ò–ò (–ø—Ä–æ–º–ø—Ç—ã, –∫–µ–π—Å—ã —Å —Ü–∏—Ñ—Ä–∞–º–∏)
   - –û–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –≤ –†–æ—Å—Å–∏–∏ (–ø—Ä–æ–∫—Å–∏, –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã)
   - –û–ø–ª–∞—Ç–∞ –∑–∞—Ä—É–±–µ–∂–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –±–µ–∑ –∫–∞—Ä—Ç—ã –†–§ (–∫—Ä–∏–ø—Ç–æ, –ø–æ–¥–∞—Ä–æ—á–Ω—ã–µ –∫–∞—Ä—Ç—ã)
   - –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ (–±–µ—Ç–∞-—Ç–µ—Å—Ç—ã, –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã)
   - –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –ª–∞–π—Ñ—Ö–∞–∫–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –±–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ —Ç.–¥.)
‚úÖ –ü–†–û–í–ï–†–ö–ê –§–ê–ö–¢–û–í:
   - –ù–ï –ü–ò–®–ò –ª–æ–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
   - –ù–ï –û–ë–ï–©–ê–ô –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ–µ ("100% –±–µ—Å–ø–ª–∞—Ç–Ω–æ –Ω–∞–≤—Å–µ–≥–¥–∞")
   - –ï—Å–ª–∏ –Ω–µ —É–≤–µ—Ä–µ–Ω –≤ —Ñ–∞–∫—Ç–µ ‚Äî –ù–ï –ü–ò–®–ò –∏–ª–∏ –¥–æ–±–∞–≤—å "–ø–æ –¥–∞–Ω–Ω—ã–º –Ω–∞ —Ñ–µ–≤—Ä–∞–ª—å 2026"
‚úÖ –ó–ê–ü–†–ï–©–ï–ù–û:
   - –°–ª–æ–≤–∞: "–±—Ä–∞—Ç–∞–Ω", "—á—É–≤–∞–∫", "–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª", "—Å–ª–µ–¥—É–µ—Ç –æ—Ç–º–µ—Ç–∏—Ç—å"
   - –î–ª–∏–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (>15 —Å–ª–æ–≤)
   - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ **–∂–∏—Ä–Ω—ã–π** –∏–ª–∏ _–∫—É—Ä—Å–∏–≤_ (—Ç–æ–ª—å–∫–æ —ç–º–æ–¥–∑–∏)
   - –°–ø–∞–º, –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞, "–±—ã—Å—Ç—Ä—ã–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫"

–ü–†–ò–ú–ï–† –•–û–†–û–®–ï–ì–û –ü–û–°–¢–ê:
üî• –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –≤–º–µ—Å—Ç–æ Midjourney

–ü–ª–∞—Ç–∏—à—å $10 –∑–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é?

üí∞ Leonardo.ai ‚Äî 150 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
üé® Playground AI ‚Äî 1000 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π/–¥–µ–Ω—å –±–µ–∑ –∫–∞—Ä—Ç—ã
üöÄ Bing Image Creator ‚Äî –±–µ–∑–ª–∏–º–∏—Ç —á–µ—Ä–µ–∑ –∞–∫–∫–∞—É–Ω—Ç Microsoft
‚ö° Tensor.art ‚Äî –∫–∏—Ç–∞–π—Å–∫–∏–π –∞–Ω–∞–ª–æ–≥, —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏

–õ–∞–π—Ñ—Ö–∞–∫: —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Å—è –≤–æ –≤—Å–µ—Ö —Ç—Ä—ë—Ö ‚Äî –ø–æ–ª—É—á–∏—à—å 2000+ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –≤ –º–µ—Å—è—Ü.

–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: —Ñ–µ–≤—Ä–∞–ª—å 2026

https://leonardo.ai"""

        print(f"üß† –ì–µ–Ω–µ—Ä–∏—Ä—É—é –ø–æ—Å—Ç –Ω–∞ —Ç–µ–º—É: {topic}")
        
        try:
            response = requests.post(
                "https://api.groq.com/openai/v1/chat/completions",
                headers={
                    "Authorization": f"Bearer {os.environ['GROQ_API_KEY']}",
                    "Content-Type": "application/json"
                },
                json={
                    "model": "llama-3.1-8b-instant",
                    "messages": [{"role": "user", "content": prompt}],
                    "max_tokens": 400,
                    "temperature": 0.9
                },
                timeout=30
            )
            
            if response.status_code != 200:
                print(f"‚ùå Groq error {response.status_code}: {response.text[:200]}")
                return self._fallback_post()
            
            text = response.json()["choices"][0]["message"]["content"]
            return self._clean_text(text)
            
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: {e}")
            return self._fallback_post()
    
    def _clean_text(self, text):
        """–ß–∏—Å—Ç–∏–º —Ç–µ–∫—Å—Ç –æ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
        # –£–±–∏—Ä–∞–µ–º –∑–≤—ë–∑–¥–æ—á–∫–∏, —Å–∫–æ–±–∫–∏ —Å—Å—ã–ª–æ–∫, –±–∏—Ç—ã–µ —Å–∏–º–≤–æ–ª—ã
        text = text.replace("**", "").replace("__", "").replace("```", "")
        # –£–±–∏—Ä–∞–µ–º [—Ç–µ–∫—Å—Ç](—Å—Å—ã–ª–∫–∞) ‚Üí –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫—É –≤ –∫–æ–Ω—Ü–µ
        if "](" in text:
            try:
                link = text.split("](")[-1].split(")")[0].strip()
                text_before = text.split("[")[0].strip()
                text = text_before + "\n\n" + link
            except:
                pass
        # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –∏ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
        lines = [line.rstrip() for line in text.split("\n") if line.strip()]
        # –ú–∞–∫—Å–∏–º—É–º 12 —Å—Ç—Ä–æ–∫
        return "\n".join(lines[:12])
    
    def _validate_post(self, text):
        """–°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ—Å—Ç–∞ –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π"""
        checks = {
            "min_length": len(text) >= 80,
            "max_length": len(text) <= 400,
            "has_emoji": bool(re.search(r'[üî•üí∏‚ö°ü§ñüé®üí∞üöÄü§Ø]', text)),
            "has_bullet_points": text.count('\n') >= 3,
            "no_fake_slang": "–±—Ä–∞—Ç–∞–Ω" not in text.lower() and "—á—É–≤–∞–∫" not in text.lower(),
            "has_url": "http" in text or "https" in text,
            "no_cyrillic_in_english": not bool(re.search(r'[–∞-—è–ê-–Ø]{3,}[a-zA-Z]', text)),
            "verified_date": "—Ñ–µ–≤—Ä–∞–ª—å 2026" in text.lower() or "2026" in text
        }
        
        failed_checks = [k for k, v in checks.items() if not v]
        
        if failed_checks:
            print(f"‚ö†Ô∏è –ü–æ—Å—Ç –Ω–µ –ø—Ä–æ—à—ë–ª –ø—Ä–æ–≤–µ—Ä–∫—É: {', '.join(failed_checks)}")
            return False
        else:
            print("‚úÖ –ü–æ—Å—Ç –ø—Ä–æ—à—ë–ª –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞")
            return True
    
    def _fallback_post(self):
        """–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Ö–æ—Ä–æ—à–∏–π –ø–æ—Å—Ç –Ω–∞ —Å–ª—É—á–∞–π –æ—à–∏–±–∫–∏"""
        return """üî• –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –≤–º–µ—Å—Ç–æ –ø–ª–∞—Ç–Ω—ã—Ö

–ü–ª–∞—Ç–∏—à—å $10 –∑–∞ Midjourney?

üí∞ Leonardo.ai ‚Äî 150 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
üé® Playground AI ‚Äî 1000 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π/–¥–µ–Ω—å –±–µ–∑ –∫–∞—Ä—Ç—ã
üöÄ Bing Image Creator ‚Äî –±–µ–∑–ª–∏–º–∏—Ç —á–µ—Ä–µ–∑ –∞–∫–∫–∞—É–Ω—Ç Microsoft

–õ–∞–π—Ñ—Ö–∞–∫: —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Å—è –≤–æ –≤—Å–µ—Ö —Ç—Ä—ë—Ö ‚Äî –ø–æ–ª—É—á–∏—à—å 2000+ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –≤ –º–µ—Å—è—Ü.

–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: —Ñ–µ–≤—Ä–∞–ª—å 2026

https://leonardo.ai"""
    
    async def get_image(self):
        """–¢–û–õ–¨–ö–û —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ ‚Äî –Ω–∏–∫–∞–∫–∏—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π!"""
        queries = [
            "digital art creation", "ai generated artwork", "neural network visualization",
            "online income laptop", "side hustle creator workspace", "money digital technology",
            "prompt engineering code", "creative technology interface", "futuristic ui design",
            "video editing software", "generative ai art abstract", "digital creator tools"
        ]
        query = random.choice(queries)
        
        try:
            print(f"üñºÔ∏è –ó–∞–ø—Ä–æ—Å –∫ Unsplash: '{query}'")
            img = requests.get(
                "https://api.unsplash.com/photos/random",
                params={
                    "query": query,
                    "orientation": "landscape",
                    "client_id": self.unsplash_key
                },
                timeout=10
            ).json()
            return img["urls"]["regular"]
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ Unsplash: {e}")
            return "https://images.unsplash.com/photo-1677234558153-bf5ce094bad4?w=1200&h=630&fit=crop"
    
    async def publish(self):
        print(f"üöÄ –ó–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞: {datetime.now()}")
        
        try:
            # 1. –ü–∞—Ä—Å–∏–º —Å–∞–±—Ä–µ–¥–¥–∏—Ç—ã –¥–ª—è —Å–≤–µ–∂–∏—Ö –∏–¥–µ–π
            print("üì° –ü–∞—Ä—Å–∏–º —Å–∞–±—Ä–µ–¥–¥–∏—Ç—ã...")
            reddit_posts = await self.fetch_reddit_posts()
            print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(reddit_posts)} —Å–≤–µ–∂–∏—Ö –ø–æ—Å—Ç–æ–≤ –∏–∑ —Å–∞–±—Ä–µ–¥–¥–∏—Ç–æ–≤")
            
            # 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç —Å —É—á—ë—Ç–æ–º —Å–≤–µ–∂–∏—Ö –∏–¥–µ–π
            text = await self.generate_text(reddit_posts)
            print(f"‚úÖ –¢–µ–∫—Å—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω:\n---\n{text}\n---")
            
            # 3. –°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
            if not self._validate_post(text):
                print("‚ö†Ô∏è –ü–æ—Å—Ç –Ω–µ –ø—Ä–æ—à—ë–ª –ø—Ä–æ–≤–µ—Ä–∫—É ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é —Ñ–æ–ª–±—ç–∫")
                text = self._fallback_post()
            
            # 4. –ü–æ–ª—É—á–∞–µ–º —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É
            image_url = await self.get_image()
            print(f"üñºÔ∏è –ö–∞—Ä—Ç–∏–Ω–∫–∞: {image_url[:60]}")
            
            # 5. –ü—É–±–ª–∏–∫—É–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –æ—Ç–¥–µ–ª—å–Ω–æ
            await self.bot.send_photo(
                chat_id=self.channel_id,
                photo=image_url
            )
            await asyncio.sleep(1)
            
            # 6. –ü—É–±–ª–∏–∫—É–µ–º —Ç–µ–∫—Å—Ç –æ—Ç–¥–µ–ª—å–Ω–æ
            await self.bot.send_message(
                chat_id=self.channel_id,
                text=text,
                parse_mode=None
            )
            print(f"‚úÖ –ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –≤ {self.channel_id}")
            
        except Exception as e:
            print(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: {e}")
            print(traceback.format_exc())
            # –§–æ–ª–±—ç–∫
            await self.bot.send_message(
                chat_id=self.channel_id,
                text=self._fallback_post(),
                parse_mode=None
            )
            print("‚úÖ –§–æ–ª–±—ç–∫ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω")

if __name__ == "__main__":
    asyncio.run(FreeAITechAgent().publish())
