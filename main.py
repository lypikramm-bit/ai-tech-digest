import os
import requests
import asyncio
from datetime import datetime
from telegram import Bot
import random
import traceback
import re

class FreeAITechAgent:
    def __init__(self):
        self.bot = Bot(token=os.environ["TELEGRAM_BOT_TOKEN"])
        self.channel_id = os.environ["TELEGRAM_CHANNEL_ID"]
        self.unsplash_key = os.environ["UNSPLASH_ACCESS_KEY"]
        self.reddit_headers = {"User-agent": "AITechBot/1.0"}
    
    async def fetch_reddit_posts(self):
        """–ü–∞—Ä—Å–∏–º –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–µ –∫–µ–π—Å—ã –±–µ–∑ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏"""
        posts = []
        subreddits = [
            ("r/StableDiffusion", "–±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è"),
            ("r/sidehustle", "—Ä–µ–∞–ª—å–Ω—ã–µ –∫–µ–π—Å—ã –∑–∞—Ä–∞–±–æ—Ç–∫–∞"),
            ("r/Midjourney", "–≥–æ—Ç–æ–≤—ã–µ –ø—Ä–æ–º–ø—Ç—ã"),
            ("r/StudentResources", "–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏")
        ]
        
        for subreddit, niche in subreddits:
            try:
                url = f"https://www.reddit.com/{subreddit}/top.json?t=month&limit=15"
                response = requests.get(url, headers=self.reddit_headers, timeout=12)
                data = response.json()
                
                for post in data["data"]["children"]:
                    title = post["data"]["title"]
                    score = post["data"]["score"]
                    if score < 150:
                        continue
                    if any(word in title.lower() for word in ["crypto", "nft", "bitcoin", "doge", "script", "code", "api", "github", "developer", "programming"]):
                        continue
                    if len(title) < 50:
                        continue
                    if not any(word in title.lower() for word in ["free", "–±–µ—Å–ø–ª–∞—Ç–Ω–æ", "–ø—Ä–æ–º–ø—Ç", "–ø–æ–¥–ø–∏—Å–∫", "–±–µ–∑ –æ–ø–ª–∞—Ç—ã", "–±–µ–∑ –∫–∞—Ä—Ç—ã", "–∑–∞—Ä–∞–±–æ—Ç"]):
                        continue
                    posts.append({
                        "title": title,
                        "subreddit": subreddit,
                        "score": score,
                        "url": post["data"]["url"]
                    })
            except:
                continue
        
        posts.sort(key=lambda x: x["score"], reverse=True)
        return posts[:4]
    
    async def generate_text(self, reddit_posts=None):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —á–µ—Å—Ç–Ω—ã–π, —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –ø–æ—Å—Ç –±–µ–∑ –∫–ª–∏–∫–±–µ–π—Ç–∞"""
        
        # –¢–µ–º—ã –±–µ–∑ –≤—ã–¥—É–º–∞–Ω–Ω—ã—Ö —Ü–∏—Ñ—Ä –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
        topics = [
            "–∫–∞–∫ –ø—Ä–æ–¥–∞–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞—Ö",
            "–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏",
            "–∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –ò–ò-—Å–µ—Ä–≤–∏—Å—ã",
            "–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –≤–∏–¥–µ–æ –±–µ–∑ –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤",
            "–∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç –≤ –ò–ò-—Å–µ—Ä–≤–∏—Å–∞—Ö –±–µ–∑ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞",
            "–∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ò–ò —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º",
            "—Ä–µ–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –Ω–∞ –ø—Ä–æ–¥–∞–∂—É –ø—Ä–æ–º–ø—Ç–æ–≤ –≤ 2026 –≥–æ–¥—É",
            "–∫–∞–∫ –≤—ã–±—Ä–∞—Ç—å –Ω–∏—à—É –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –ø—Ä–æ–º–ø—Ç–æ–≤",
            "–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã Midjourney –±–µ–∑ –∫–∞—Ä—Ç—ã",
            "–∫–∞–∫ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å 100 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –¥–µ–Ω—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ"
        ]
        topic = random.choice(topics)
        
        context = ""
        if reddit_posts:
            top = reddit_posts[:3]
            context = "–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è:\n" + "\n".join([
                f"‚Ä¢ {post['title']} ({post['subreddit']}, {post['score']}‚Üë)"
                for post in top
            ])
        
        prompt = f"""–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ò–ò. –ü–∏—à–µ—à—å —á–µ—Å—Ç–Ω—ã–µ, –ø–æ–ª–µ–∑–Ω—ã–µ –ø–æ—Å—Ç—ã –±–µ–∑ –∫–ª–∏–∫–±–µ–π—Ç–∞.

–¢–µ–º–∞: {topic}

{context}

–°–¢–†–£–ö–¢–£–†–ê –ü–û–°–¢–ê (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û):
1. –ó–∞–≥–æ–ª–æ–≤–æ–∫: "–ö–∞–∫ [–¥–µ–π—Å—Ç–≤–∏–µ]" –∏–ª–∏ "[–°–µ—Ä–≤–∏—Å] ‚Äî —á—Ç–æ –¥–∞—ë—Ç –±–µ—Å–ø–ª–∞—Ç–Ω–æ"
   ‚Äî –ó–ê–ü–†–ï–©–ï–ù–û –Ω–∞—á–∏–Ω–∞—Ç—å —Å "–ó–∞—Ä–∞–±–æ—Ç–∞–ª $–•–•–•", "–°–¥–µ–ª–∞–ª –∑–∞ 5 –º–∏–Ω—É—Ç", "–ú–æ–π –∫–µ–π—Å"
   ‚Äî –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤:
     ‚úÖ "–ö–∞–∫ –ø—Ä–æ–¥–∞–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞—Ö"
     ‚úÖ "Leonardo.ai ‚Äî 150 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π"
     ‚úÖ "–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –ò–ò"

2. –ü—Ä–æ–±–ª–µ–º–∞: 1 —Å—Ç—Ä–æ–∫–∞ ("–ü–ª–∞—Ç–∏—à—å –∑–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π?")

3. –†–µ—à–µ–Ω–∏–µ: –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞/–º–µ—Ç–æ–¥–∞ + —á—Ç–æ –¥–∞—ë—Ç

4. –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (3-5 —à–∞–≥–æ–≤):
   ‚Äî –¢–æ–ª—å–∫–æ –¥–µ–π—Å—Ç–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–æ–≤–∏—á–æ–∫ –∑–∞ 2 –º–∏–Ω—É—Ç—ã
   ‚Äî –ù–∏–∫–∞–∫–∏—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤: "—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π", "—Å–∫—Ä–∏–ø—Ç", "API", "—Ö–æ—Å—Ç–∏–Ω–≥"
   ‚Äî –ü—Ä–∏–º–µ—Ä: "1. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ leonardo.ai ‚Üí 2. –ù–∞–∂–º–∏ Sign Up ‚Üí 3. –í—ã–±–µ—Ä–∏ Google"

5. –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ü–∏—Ñ—Ä—ã (–¢–û–õ–¨–ö–û –≤–Ω—É—Ç—Ä–∏ –ø–æ—Å—Ç–∞, –Ω–µ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ):
   ‚Äî –ü—Ä–∏–º–µ—Ä: "–¶–µ–Ω–∞ –ø—Ä–æ–º–ø—Ç–∞: $3-7", "–î–æ—Ö–æ–¥ –Ω–æ–≤–∏—á–∫–∞: $50-150 –∑–∞ 60 –¥–Ω–µ–π"
   ‚Äî –ò—Å—Ç–æ—á–Ω–∏–∫: "–¥–∞–Ω–Ω—ã–µ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞", "–æ–ø—Ä–æ—Å 200 –∞–≤—Ç–æ—Ä–æ–≤"

6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (—á–µ—Å—Ç–Ω–æ):
   ‚Äî "150 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –ø–æ—Ç–æ–º 5/–¥–µ–Ω—å"
   ‚Äî "–ë–µ–∑ –∫–∞—Ä—Ç—ã –†–§ ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –ø–æ–¥–∞—Ä–æ—á–Ω—ã–µ –∫–∞—Ä—Ç—ã"

7. –°—Å—ã–ª–∫–∞: –ø—Ä—è–º–∞—è, —Ä–∞–±–æ—á–∞—è. –ù–ò–ö–û–ì–î–ê –Ω–µ –ø–∏—à–∏ "—à–∞–±–ª–æ–Ω –≤ –æ–ø–∏—Å–∞–Ω–∏–∏" –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç.

–ü–†–ê–í–ò–õ–ê:
‚úÖ –ö–∞–∂–¥—ã–π –ø–æ—Å—Ç ‚Äî —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π. –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤–Ω—É—Ç—Ä–∏.
‚úÖ –ó–∞–≥–æ–ª–æ–≤–æ–∫ = –æ–±—É—á–µ–Ω–∏–µ ("–∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å"), –∞ –Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç ("—è —Å–¥–µ–ª–∞–ª").
‚úÖ –¶–∏—Ñ—Ä—ã –¥–æ—Ö–æ–¥–∞ ‚Äî —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –ø–æ—Å—Ç–∞, —Å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º, —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ.
‚úÖ –ù–∏–∫–∞–∫–æ–≥–æ –∫–ª–∏–∫–±–µ–π—Ç–∞: "–≤ –æ–ø–∏—Å–∞–Ω–∏–∏ —Å–µ–∫—Ä–µ—Ç", "—Ç–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è", "–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø".
‚úÖ –ó–∞–ø—Ä–µ—â–µ–Ω–æ:
   - "–ª–∞–π—Ñ—Ö–∞–∫", "–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ", "–±—Ä–∞—Ç–∞–Ω", "—á—É–≤–∞–∫"
   - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç–µ–º—ã (–∫–æ–¥, —Å–∫—Ä–∏–ø—Ç—ã, —Å–µ—Ä–≤–µ—Ä—ã)
   - –í—ã–¥—É–º–∞–Ω–Ω—ã–µ —Ü–∏—Ñ—Ä—ã –¥–æ—Ö–æ–¥–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
   - –û–±–µ—â–∞–Ω–∏—è "–±–µ—Å–ø–ª–∞—Ç–Ω–æ –Ω–∞–≤—Å–µ–≥–¥–∞"
‚úÖ –°—Ç–∏–ª—å: –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, —ç–º–æ–¥–∑–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è (üé® üí∏ üé•), –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∞.

–ü–†–ò–ú–ï–† –ò–î–ï–ê–õ–¨–ù–û–ì–û –ü–û–°–¢–ê:
üé® –ö–∞–∫ –ø—Ä–æ–¥–∞–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã –∏ –ø–æ–ª—É—á–∞—Ç—å $3-7 –∑–∞ —à—Ç—É–∫—É

–•–æ—á–µ—à—å –º–æ–Ω–µ—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≤—ã–∫–∏ —Ä–∞–±–æ—Ç—ã —Å –ò–ò?

–ì–¥–µ –ø—Ä–æ–¥–∞–≤–∞—Ç—å:
‚Ä¢ PromptBase ‚Äî –∫—Ä—É–ø–Ω–µ–π—à–∏–π –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –ø—Ä–æ–º–ø—Ç–æ–≤
‚Ä¢ ArtHub ‚Äî –Ω–∏—à–µ–≤—ã–π —Ä—ã–Ω–æ–∫ –¥–ª—è —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤

–ö–∞–∫ –Ω–∞—á–∞—Ç—å:
1. –í—ã–±–µ—Ä–∏ —É–∑–∫—É—é –Ω–∏—à—É (–∫–æ—Ñ–µ–π–Ω–∏, –≤–µ—Ç–∫–ª–∏–Ω–∏–∫–∏)
2. –°–æ–∑–¥–∞–π 5-7 –ø—Ä–æ–º–ø—Ç–æ–≤ –ø–æ–¥ —ç—Ç—É –Ω–∏—à—É
3. –°–¥–µ–ª–∞–π 3-4 –ø—Ä–∏–º–µ—Ä–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ
4. –ó–∞–≥—Ä—É–∑–∏ –Ω–∞ PromptBase —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
5. –¶–µ–Ω–∞: $3-7 –∑–∞ –ø—Ä–æ–º–ø—Ç

–†–µ–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã (–¥–∞–Ω–Ω—ã–µ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞, —Ñ–µ–≤—Ä–∞–ª—å 2026):
‚Äî –¢–æ–ø-10% –∞–≤—Ç–æ—Ä–æ–≤ –ø—Ä–æ–¥–∞—é—Ç 15-25 –ø—Ä–æ–º–ø—Ç–æ–≤/–º–µ—Å—è—Ü
‚Äî –°—Ä–µ–¥–Ω–∏–π –¥–æ—Ö–æ–¥ –Ω–æ–≤–∏—á–∫–∞: $50-150 –∑–∞ –ø–µ—Ä–≤—ã–µ 60 –¥–Ω–µ–π

–í–∞–∂–Ω–æ: –¥–æ—Ö–æ–¥ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π. –ü—Ä–æ–º–ø—Ç –º–æ–∂–µ—Ç –ø—Ä–æ–¥–∞–≤–∞—Ç—å—Å—è –≥–æ–¥–∞–º–∏.

–ù–∞—á–∞—Ç—å –º–æ–∂–Ω–æ –∑–∞ 20 –º–∏–Ω—É—Ç –±–µ–∑ –≤–ª–æ–∂–µ–Ω–∏–π.

https://promptbase.com"""

        print(f"üß† –ì–µ–Ω–µ—Ä–∏—Ä—É—é –ø–æ—Å—Ç –Ω–∞ —Ç–µ–º—É: {topic}")
        
        try:
            response = requests.post(
                "https://api.groq.com/openai/v1/chat/completions",
                headers={
                    "Authorization": f"Bearer {os.environ['GROQ_API_KEY']}",
                    "Content-Type": "application/json"
                },
                json={
                    "model": "llama-3.1-70b-versatile",
                    "messages": [{"role": "user", "content": prompt}],
                    "max_tokens": 600,
                    "temperature": 0.6  # –ú–∏–Ω–∏–º—É–º –≤—ã–¥—É–º–æ–∫
                },
                timeout=40
            )
            
            if response.status_code != 200:
                return self._fallback_post()
            
            text = response.json()["choices"][0]["message"]["content"]
            return self._clean_and_validate(text)
            
        except:
            return self._fallback_post()
    
    def _clean_and_validate(self, text):
        """–ß–∏—Å—Ç–∏–º —Ç–µ–∫—Å—Ç + –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –∫–ª–∏–∫–±–µ–π—Ç –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ"""
        # –£–±–∏—Ä–∞–µ–º –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ —Å–ª–æ–≤–∞
        text = re.sub(r'(?i)–ª–∞–π—Ñ—Ö–∞–∫[:\s]*', '', text)
        text = re.sub(r'(?i)–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ[:\s–∞-—è0-9]+', '', text)
        text = re.sub(r'–≤ –æ–ø–∏—Å–∞–Ω.*|–≤ –∑–∞–∫—Ä–µ–ø.*|–≤ –ø—Ä–æ—Ñ–∏–ª–µ.*', '', text, flags=re.IGNORECASE)
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –Ω–∞ –∫–ª–∏–∫–±–µ–π—Ç —Å —Ü–∏—Ñ—Ä–∞–º–∏ –¥–æ—Ö–æ–¥–∞
        lines = [line.strip() for line in text.split("\n") if line.strip()]
        if lines:
            first_line = lines[0].lower()
            # –ï—Å–ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "–∑–∞—Ä–∞–±–æ—Ç–∞–ª $", "—Å–¥–µ–ª–∞–ª –∑–∞ –• –º–∏–Ω—É—Ç" ‚Äî –∑–∞–º–µ–Ω—è–µ–º
            if re.search(r'^(–∑–∞—Ä–∞–±–æ—Ç–∞–ª|—Å–¥–µ–ª–∞–ª|–ø–æ–ª—É—á–∏–ª)\s*\$?\d', first_line):
                # –ó–∞–º–µ–Ω—è–µ–º –Ω–∞ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
                new_title = "üé® –ö–∞–∫ –º–æ–Ω–µ—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≤—ã–∫–∏ —Ä–∞–±–æ—Ç—ã —Å –ò–ò"
                text = new_title + "\n\n" + "\n".join(lines[1:])
        
        # –§–∏–ª—å—Ç—Ä—É–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
        lines = [line.rstrip() for line in text.split("\n") if line.strip()]
        return "\n".join(lines[:25])
    
    def _fallback_post(self):
        """–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —á–µ—Å—Ç–Ω—ã–π –ø–æ—Å—Ç"""
        return """üé® –ö–∞–∫ –ø—Ä–æ–¥–∞–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã –∏ –ø–æ–ª—É—á–∞—Ç—å $3-7 –∑–∞ —à—Ç—É–∫—É

–•–æ—á–µ—à—å –º–æ–Ω–µ—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≤—ã–∫–∏ —Ä–∞–±–æ—Ç—ã —Å –ò–ò?

–ì–¥–µ –ø—Ä–æ–¥–∞–≤–∞—Ç—å:
‚Ä¢ PromptBase ‚Äî –∫—Ä—É–ø–Ω–µ–π—à–∏–π –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –ø—Ä–æ–º–ø—Ç–æ–≤
‚Ä¢ ArtHub ‚Äî –Ω–∏—à–µ–≤—ã–π —Ä—ã–Ω–æ–∫ –¥–ª—è —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤

–ö–∞–∫ –Ω–∞—á–∞—Ç—å:
1. –í—ã–±–µ—Ä–∏ —É–∑–∫—É—é –Ω–∏—à—É (–∫–æ—Ñ–µ–π–Ω–∏, –≤–µ—Ç–∫–ª–∏–Ω–∏–∫–∏, –±—É–∫–º–µ–∫–µ—Ä—Å–∫–∏–µ –∫–æ–Ω—Ç–æ—Ä—ã)
2. –°–æ–∑–¥–∞–π 5-7 –ø—Ä–æ–º–ø—Ç–æ–≤ –ø–æ–¥ —ç—Ç—É –Ω–∏—à—É
3. –°–¥–µ–ª–∞–π 3-4 –ø—Ä–∏–º–µ—Ä–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
4. –ó–∞–≥—Ä—É–∑–∏ –Ω–∞ PromptBase —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
5. –¶–µ–Ω–∞: $3-7 –∑–∞ –ø—Ä–æ–º–ø—Ç (–Ω–∏–∂–µ $3 ‚Äî –Ω–µ –ø—Ä–æ–¥–∞—ë—Ç—Å—è)

–†–µ–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã (–¥–∞–Ω–Ω—ã–µ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞, —Ñ–µ–≤—Ä–∞–ª—å 2026):
‚Äî –¢–æ–ø-10% –∞–≤—Ç–æ—Ä–æ–≤ –ø—Ä–æ–¥–∞—é—Ç 15-25 –ø—Ä–æ–º–ø—Ç–æ–≤/–º–µ—Å—è—Ü
‚Äî –°—Ä–µ–¥–Ω–∏–π –¥–æ—Ö–æ–¥ –Ω–æ–≤–∏—á–∫–∞: $50-150 –∑–∞ –ø–µ—Ä–≤—ã–µ 60 –¥–Ω–µ–π
‚Äî –ü—Ä–æ–¥–∞–∂–∏ —Ä–∞—Å—Ç—É—Ç –ø–æ—Å–ª–µ 20 –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤

–í–∞–∂–Ω–æ: –¥–æ—Ö–æ–¥ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π. –ü—Ä–æ–º–ø—Ç –º–æ–∂–µ—Ç –ø—Ä–æ–¥–∞–≤–∞—Ç—å—Å—è –≥–æ–¥–∞–º–∏.

–ù–∞—á–∞—Ç—å –º–æ–∂–Ω–æ –∑–∞ 20 –º–∏–Ω—É—Ç –±–µ–∑ –≤–ª–æ–∂–µ–Ω–∏–π.

https://promptbase.com"""
    
    async def get_image(self):
        """–†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –±–µ–∑ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π"""
        queries = [
            "creative workspace laptop", "digital art creation", "ai interface design",
            "online income stream", "content creation tools", "neural network abstract",
            "prompt engineering", "generative art process", "side hustle creator"
        ]
        query = random.choice(queries)
        
        try:
            img = requests.get(
                "https://api.unsplash.com/photos/random",
                params={"query": query, "orientation": "landscape", "client_id": self.unsplash_key},
                timeout=10
            ).json()
            return img["urls"]["regular"]
        except:
            return "https://images.unsplash.com/photo-1677234558153-bf5ce094bad4?w=1200&h=630&fit=crop"
    
    async def publish(self):
        print(f"üöÄ –ó–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞: {datetime.now()}")
        
        try:
            reddit_posts = await self.fetch_reddit_posts()
            print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(reddit_posts)} –ø—Ä–∞–∫—Ç–∏—á–Ω—ã—Ö –∫–µ–π—Å–æ–≤")
            
            text = await self.generate_text(reddit_posts)
            print(f"‚úÖ –¢–µ–∫—Å—Ç:\n---\n{text}\n---")
            
            image_url = await self.get_image()
            print(f"üñºÔ∏è –ö–∞—Ä—Ç–∏–Ω–∫–∞: {image_url[:60]}")
            
            await self.bot.send_photo(chat_id=self.channel_id, photo=image_url)
            await asyncio.sleep(1)
            await self.bot.send_message(chat_id=self.channel_id, text=text, parse_mode=None)
            print(f"‚úÖ –ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –≤ {self.channel_id}")
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
            await self.bot.send_message(chat_id=self.channel_id, text=self._fallback_post(), parse_mode=None)
            print("‚úÖ –§–æ–ª–±—ç–∫ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω")

if __name__ == "__main__":
    asyncio.run(FreeAITechAgent().publish())
