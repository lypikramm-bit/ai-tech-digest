import os
import requests
import asyncio
from datetime import datetime
from telegram import Bot
import random
import traceback
import re
import html

class FreeAITechAgent:
    def __init__(self):
        self.bot = Bot(token=os.environ["TELEGRAM_BOT_TOKEN"])
        self.user_id = os.environ["TELEGRAM_USER_ID"]
        self.unsplash_key = os.environ["UNSPLASH_ACCESS_KEY"]
        self.reddit_headers = {"User-agent": "AITechBot/1.0"}
        
        self.categories = ["–Ω–æ–≤–∏–Ω–∫–∏", "–ø—Ä–∏—ë–º—ã", "–∏–Ω—Å–∞–π–¥—ã", "–º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è", "–¥–æ—Å—Ç—É–ø"]
        self.category = random.choice(self.categories)
    
    async def fetch_reddit_posts(self):
        posts = []
        subreddits = [
            ("r/StableDiffusion", "–≥–µ–Ω–µ—Ä–∞—Ü–∏—è"),
            ("r/sidehustle", "–∑–∞—Ä–∞–±–æ—Ç–æ–∫"),
            ("r/Midjourney", "–ø—Ä–æ–º–ø—Ç—ã"),
            ("r/ArtificialIntelligence", "–Ω–æ–≤–æ—Å—Ç–∏ –ò–ò")
        ]
        
        for subreddit, niche in subreddits:
            try:
                url = f"https://www.reddit.com/{subreddit}/top.json?t=week&limit=10"
                response = requests.get(url, headers=self.reddit_headers, timeout=10)
                data = response.json()
                
                for post in data["data"]["children"]:
                    title = post["data"]["title"]
                    score = post["data"]["score"]
                    if score < 80:
                        continue
                    if any(word in title.lower() for word in ["crypto", "nft", "bitcoin", "scam", "tutorial", "for beginners", "guide for"]):
                        continue
                    if len(title) < 40:
                        continue
                    posts.append({
                        "title": title,
                        "subreddit": subreddit,
                        "score": score
                    })
            except:
                continue
        
        posts.sort(key=lambda x: x["score"], reverse=True)
        return posts[:3]
    
    async def generate_text(self, reddit_posts=None):
        topics_by_category = {
            "–Ω–æ–≤–∏–Ω–∫–∏": [
                "–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤–∏–¥–µ–æ –±–µ–∑ –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤ –≤—ã—à–µ–ª –≤ —Ñ–µ–≤—Ä–∞–ª–µ 2026",
                "–Ω–æ–≤–∞—è –º–æ–¥–µ–ª—å –ò–ò –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 4–ö –≤–∏–¥–µ–æ –∑–∞ 8 —Å–µ–∫—É–Ω–¥",
                "—Ä–æ—Å—Å–∏–π—Å–∫–∏–π –∞–Ω–∞–ª–æ–≥ Midjourney —Å—Ç–∞–ª –¥–æ—Å—Ç—É–ø–µ–Ω –±–µ–∑ –∫–∞—Ä—Ç—ã",
                "–±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∑–∞–º–µ–Ω–∞ Runway ML —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞",
                "–Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞–≤–∞—Ç–∞—Ä–∫–∏ –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π –∑–∞ 1 –∫–ª–∏–∫"
            ],
            "–ø—Ä–∏—ë–º—ã": [
                "–∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å 1000 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –≤ –¥–µ–Ω—å –∫–æ–º–±–∏–Ω–∏—Ä—É—è 3 —Å–µ—Ä–≤–∏—Å–∞",
                "–∫–∞–∫ –æ–±–æ–π—Ç–∏ –ª–∏–º–∏—Ç 5 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –≤ Leonardo.ai –±–µ–∑ –¥–æ–ø–ª–∞—Ç—ã",
                "–∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç –≤ –ò–ò-—Å–µ—Ä–≤–∏—Å–∞—Ö –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞",
                "–∫–∞–∫ –±–µ—Å–ø–ª–∞—Ç–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ 1080—Ä –±–µ–∑ –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤",
                "–∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã –∏–∑ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è –ø—Ä–∞–≤"
            ],
            "–∏–Ω—Å–∞–π–¥—ã": [
                "–∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∑–∞–∫—Ä—ã—Ç–æ–π –±–µ—Ç–µ –Ω–æ–≤–æ–≥–æ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –≤–∏–¥–µ–æ",
                "–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –æ—Ç —Ç–æ–ø–æ–≤—ã—Ö —Å–æ–∑–¥–∞—Ç–µ–ª–µ–π –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –¥–æ—Å—Ç—É–ø–µ",
                "–∫–∞–∫ –æ–±–æ–π—Ç–∏ —Ü–µ–Ω–∑—É—Ä—É –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞—Ö –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–∑—Ä–æ—Å–ª–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞",
                "–∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ –≤ Leonardo.ai –±–µ—Å–ø–ª–∞—Ç–Ω–æ —á–µ—Ä–µ–∑ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º",
                "—Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∏–¥–µ–∞–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ Stable Diffusion"
            ],
            "–º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è": [
                "–∫–∞–∫ –ø—Ä–æ–¥–∞–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã –∏ –ø–æ–ª—É—á–∞—Ç—å $3-7 –∑–∞ —à—Ç—É–∫—É –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞—Ö",
                "–∫–∞–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å $200-500 –≤ –º–µ—Å—è—Ü –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞",
                "–∫–∞–∫ –≤—ã–±—Ä–∞—Ç—å –Ω–∏—à—É –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–µ–π",
                "—Ä–µ–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã –¥–æ—Ö–æ–¥–∞ –æ—Ç –ø—Ä–æ–¥–∞–∂–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ –≤ —Ñ–µ–≤—Ä–∞–ª–µ 2026",
                "–∫–∞–∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥–∞–∂–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–æ $1000/–º–µ—Å –±–µ–∑ —Ä–µ–∫–ª–∞–º—ã"
            ],
            "–¥–æ—Å—Ç—É–ø": [
                "–∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ò–ò-—Å–µ—Ä–≤–∏—Å–∞–º –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è –∑–∞–∫–æ–Ω–∞",
                "–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø–ª–∞—Ç–Ω—ã–µ –ò–ò-—Å–µ—Ä–≤–∏—Å—ã –±–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–ª—è –≤—Å–µ—Ö",
                "–∫–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å –∑–∞—Ä—É–±–µ–∂–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –±–µ–∑ –∫–∞—Ä—Ç—ã –†–§ —á–µ—Ä–µ–∑ –ø–æ–¥–∞—Ä–æ—á–Ω—ã–µ –∫–∞—Ä—Ç—ã",
                "–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∑–µ—Ä–∫–∞–ª–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞–º –∏–∑ –†–æ—Å—Å–∏–∏",
                "–∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ò–ò-—Å–µ—Ä–≤–∏—Å—ã —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏"
            ]
        }
        
        topic = random.choice(topics_by_category.get(self.category, topics_by_category["–º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è"]))
        
        category_emoji = {
            "–Ω–æ–≤–∏–Ω–∫–∏": "üÜï",
            "–ø—Ä–∏—ë–º—ã": "üí°",
            "–∏–Ω—Å–∞–π–¥—ã": "üîí",
            "–º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è": "üí∞",
            "–¥–æ—Å—Ç—É–ø": "üåç"
        }
        emoji = category_emoji.get(self.category, "ü§ñ")
        
        prompt = f"""–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ò–ò. –ü–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–∏–µ, –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–µ –ø–æ—Å—Ç—ã –¥–ª—è —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏ 20-45 –ª–µ—Ç.

–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {self.category}
–¢–µ–º–∞: {topic}

–°–¢–†–£–ö–¢–£–†–ê –ü–û–°–¢–ê:
1. –ó–∞–≥–æ–ª–æ–≤–æ–∫: <b>{emoji} [—Ü–µ–ø–ª—è—é—â–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –≤—ã–≥–æ–¥–æ–π]</b>
2. –ü—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å: 1 —Å—Ç—Ä–æ–∫–∞
3. –°–ø–∏—Å–æ–∫ –∏–∑ 3-4 –ø—É–Ω–∫—Ç–æ–≤:
   ‚Äî –ö–∞–∂–¥—ã–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —ç–º–æ–¥–∑–∏
   ‚Äî –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ <b>–∂–∏—Ä–Ω–æ–º</b>
   ‚Äî –î–µ—Ç–∞–ª–∏ –≤ <i>–∫—É—Ä—Å–∏–≤–µ</i>
4. –¶–∏—Ñ—Ä—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (—á–µ—Å—Ç–Ω–æ)
5. –ö–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞: <a href="URL">–¥–µ–π—Å—Ç–≤–∏–µ</a>

–ó–ê–ü–†–ï–©–ï–ù–û:
‚ùå –°–ª–æ–≤–∞ "–≥–∞–π–¥", "–¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤", "–ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è", "—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ"
‚ùå –°–ª–æ–≤–∞ "–ª–∞–π—Ñ—Ö–∞–∫", "–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ", "–±—Ä–∞—Ç–∞–Ω", "—á—É–≤–∞–∫"
‚ùå –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤—Ä–æ–¥–µ "—Å–∫–æ–ø–∏—Ä—É–π –∏ –≤—Å—Ç–∞–≤—å", "—Å–ª–µ–¥—É–π —à–∞–≥–∞–º"
‚ùå –¢–µ–º—ã –ø—Ä–æ –æ–±—É—á–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–∞–º ‚Äî —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –≤—ã–≥–æ–¥–∞
‚ùå –í–æ–¥–∞ –∏ –æ–±—â–∏–µ —Ñ—Ä–∞–∑—ã ‚Äî –∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ = –ø–æ–ª—å–∑–∞

–ü–†–ò–ú–ï–† –•–û–†–û–®–ï–ì–û –ü–û–°–¢–ê:
<b>üí∞ –ö–∞–∫ –ø—Ä–æ–¥–∞–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã –∏ –ø–æ–ª—É—á–∞—Ç—å $3-7 –∑–∞ —à—Ç—É–∫—É</b>

–ú–æ–Ω–µ—Ç–∏–∑–∏—Ä—É–π –Ω–∞–≤—ã–∫–∏ —Ä–∞–±–æ—Ç—ã —Å –ò–ò –±–µ–∑ –≤–ª–æ–∂–µ–Ω–∏–π.

–ì–¥–µ –ø—Ä–æ–¥–∞–≤–∞—Ç—å:
‚Ä¢ <b>PromptBase</b> ‚Äî <i>–∫—Ä—É–ø–Ω–µ–π—à–∏–π –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å</i>
‚Ä¢ <b>Telegram-–∫–∞–Ω–∞–ª—ã</b> ‚Äî <i>–ø—Ä—è–º—ã–µ –ø—Ä–æ–¥–∞–∂–∏</i>

–ö–∞–∫ –Ω–∞—á–∞—Ç—å:
1. –í—ã–±–µ—Ä–∏ —É–∑–∫—É—é –Ω–∏—à—É (–∫–æ—Ñ–µ–π–Ω–∏, –≤–µ—Ç–∫–ª–∏–Ω–∏–∫–∏)
2. –°–æ–∑–¥–∞–π 5-7 –ø—Ä–æ–º–ø—Ç–æ–≤
3. –°–¥–µ–ª–∞–π 3 –ø—Ä–∏–º–µ—Ä–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ
4. –ó–∞–≥—Ä—É–∑–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å

–†–µ–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã (—Ñ–µ–≤—Ä–∞–ª—å 2026):
‚Äî –°—Ä–µ–¥–Ω–∏–π –¥–æ—Ö–æ–¥ –Ω–æ–≤–∏—á–∫–∞: $50-150 –∑–∞ 60 –¥–Ω–µ–π

<a href="https://promptbase.com">–ü—Ä–æ–¥–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã</a>"""

        try:
            response = requests.post(
                "https://api.groq.com/openai/v1/chat/completions",
                headers={
                    "Authorization": f"Bearer {os.environ['GROQ_API_KEY']}",
                    "Content-Type": "application/json"
                },
                json={
                    "model": "llama-3.1-70b-versatile",
                    "messages": [{"role": "user", "content": prompt}],
                    "max_tokens": 450,
                    "temperature": 0.7
                },
                timeout=35
            )
            
            if response.status_code != 200:
                return self._fallback_post()
            
            text = response.json()["choices"][0]["message"]["content"]
            return self._clean_html(text)
            
        except:
            return self._fallback_post()
    
    def _clean_html(self, text):
        text = text.replace("**", "").replace("__", "").replace("```", "")
        text = html.escape(text, quote=False)
        text = re.sub(r'&lt;b&gt;(.*?)&lt;/b&gt;', r'<b>\1</b>', text)
        text = re.sub(r'&lt;i&gt;(.*?)&lt;/i&gt;', r'<i>\1</i>', text)
        text = re.sub(r'&lt;a href=&quot;(.*?)&quot;&gt;(.*?)&lt;/a&gt;', r'<a href="\1">\2</a>', text)
        text = re.sub(r'(?i)–ª–∞–π—Ñ—Ö–∞–∫[:\s]*', '', text)
        text = re.sub(r'(?i)–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ[:\s–∞-—è0-9]+', '', text)
        text = re.sub(r'(?i)–≥–∞–π–¥|—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ|–¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤|–ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è', '', text)
        if len(text) > 850:
            text = text[:847] + "..."
        lines = [line.rstrip() for line in text.split("\n") if line.strip()]
        return "\n".join(lines[:20])
    
    def _fallback_post(self):
        fallbacks = {
            "–Ω–æ–≤–∏–Ω–∫–∏": """<b>üÜï –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤–∏–¥–µ–æ –±–µ–∑ –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤</b>

–£—Å—Ç–∞–ª –æ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –≤ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö?

–ß—Ç–æ –¥–∞—ë—Ç:
üé• <b>Runway Lite</b> ‚Äî <i>–±–µ—Å–ø–ª–∞—Ç–Ω–æ 120 —Å–µ–∫—É–Ω–¥ –≤–∏–¥–µ–æ –≤ –º–µ—Å—è—Ü</i>
üé¨ <b>Pika 2.0</b> ‚Äî <i>150 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –±–µ–∑ –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤</i>
üöÄ <b>LeiaPix</b> ‚Äî <i>–∞–Ω–∏–º–∞—Ü–∏—è —Ñ–æ—Ç–æ –∑–∞ 10 —Å–µ–∫—É–Ω–¥ –±–µ—Å–ø–ª–∞—Ç–Ω–æ</i>

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
‚Äî –ú–∞–∫—Å–∏–º—É–º 10 —Å–µ–∫—É–Ω–¥ –Ω–∞ –≤–∏–¥–µ–æ –≤ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º —Ç–∞—Ä–∏—Ñ–µ
‚Äî –ù–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π –∏ —Å—Ç–æ—Ä–∏—Å

<a href="https://pika.art">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ</a>""",
            "–ø—Ä–∏—ë–º—ã": """<b>üí° 1000 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –≤ –¥–µ–Ω—å ‚Äî —Å—Ö–µ–º–∞</b>

Leonardo.ai –¥–∞—ë—Ç —Ç–æ–ª—å–∫–æ 5 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π/–¥–µ–Ω—å? –ï—Å—Ç—å —Ä–µ—à–µ–Ω–∏–µ.

–°—Ö–µ–º–∞:
üñºÔ∏è <b>Leonardo.ai</b> ‚Äî <i>150 –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ + 5/–¥–µ–Ω—å</i>
üé® <b>Playground AI</b> ‚Äî <i>1000 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π/–¥–µ–Ω—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ</i>
üöÄ <b>Bing Image Creator</b> ‚Äî <i>–±–µ–∑–ª–∏–º–∏—Ç —á–µ—Ä–µ–∑ –∞–∫–∫–∞—É–Ω—Ç Microsoft</i>

–§–æ–∫—É—Å: —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Å—è –≤–æ –≤—Å–µ—Ö —Ç—Ä—ë—Ö ‚Äî –ø–æ–ª—É—á–∏—à—å 2000+ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –≤ –º–µ—Å—è—Ü.

<a href="https://leonardo.ai">–ù–∞—á–∞—Ç—å —Å Leonardo</a>""",
            "–∏–Ω—Å–∞–π–¥—ã": """<b>üîí –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ –≤ Leonardo.ai –±–µ—Å–ø–ª–∞—Ç–Ω–æ</b>

–ú–∞–ª–æ –∫—Ç–æ –∑–Ω–∞–µ—Ç –ø—Ä–æ —Å–∫—Ä—ã—Ç—ã–π —Ä–µ–∂–∏–º –¥–æ—Å—Ç—É–ø–∞.

–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å:
1. –ó–∞–π–¥–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞
2. –í–∫–ª—é—á–∏ ¬´–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏¬ª
3. –ü–æ–ª—É—á–∏ –¥–æ—Å—Ç—É–ø –∫ SDXL Turbo –∏ Flux –±–µ—Å–ø–ª–∞—Ç–Ω–æ

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
‚Äî –¢–æ–ª—å–∫–æ 50 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π/–¥–µ–Ω—å
‚Äî –ù–æ –∫–∞—á–µ—Å—Ç–≤–æ –∫–∞–∫ —É –ø–ª–∞—Ç–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π

<a href="https://leonardo.ai">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ</a>""",
            "–º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è": """<b>üí∞ –ö–∞–∫ –ø—Ä–æ–¥–∞–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã –∏ –ø–æ–ª—É—á–∞—Ç—å $3-7 –∑–∞ —à—Ç—É–∫—É</b>

–ú–æ–Ω–µ—Ç–∏–∑–∏—Ä—É–π –Ω–∞–≤—ã–∫–∏ —Ä–∞–±–æ—Ç—ã —Å –ò–ò –±–µ–∑ –≤–ª–æ–∂–µ–Ω–∏–π.

–ì–¥–µ –ø—Ä–æ–¥–∞–≤–∞—Ç—å:
‚Ä¢ <b>PromptBase</b> ‚Äî <i>–∫—Ä—É–ø–Ω–µ–π—à–∏–π –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å</i>
‚Ä¢ <b>Telegram-–∫–∞–Ω–∞–ª—ã</b> ‚Äî <i>–ø—Ä—è–º—ã–µ –ø—Ä–æ–¥–∞–∂–∏</i>

–ö–∞–∫ –Ω–∞—á–∞—Ç—å:
1. –í—ã–±–µ—Ä–∏ —É–∑–∫—É—é –Ω–∏—à—É (–∫–æ—Ñ–µ–π–Ω–∏, –≤–µ—Ç–∫–ª–∏–Ω–∏–∫–∏)
2. –°–æ–∑–¥–∞–π 5-7 –ø—Ä–æ–º–ø—Ç–æ–≤
3. –°–¥–µ–ª–∞–π 3 –ø—Ä–∏–º–µ—Ä–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ
4. –ó–∞–≥—Ä—É–∑–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å

–†–µ–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã (—Ñ–µ–≤—Ä–∞–ª—å 2026):
‚Äî –°—Ä–µ–¥–Ω–∏–π –¥–æ—Ö–æ–¥ –Ω–æ–≤–∏—á–∫–∞: $50-150 –∑–∞ 60 –¥–Ω–µ–π

<a href="https://promptbase.com">–ü—Ä–æ–¥–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã</a>""",
            "–¥–æ—Å—Ç—É–ø": """<b>üåç –ö–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å –ò–ò-—Å–µ—Ä–≤–∏—Å—ã –±–µ–∑ –∫–∞—Ä—Ç—ã –†–§</b>

–•–æ—á–µ—à—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–ª–∞—Ç–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –±–∞–Ω–∫—É?

–°–ø–æ—Å–æ–±—ã:
üîê <b>–ü–æ–¥–∞—Ä–æ—á–Ω—ã–µ –∫–∞—Ä—Ç—ã</b> ‚Äî <i>–ø–æ–∫—É–ø–∞–π –Ω–∞ –∑–∞—Ä—É–±–µ–∂–Ω—ã—Ö —Å–∞–π—Ç–∞—Ö —á–µ—Ä–µ–∑ –ø–æ—Å—Ä–µ–¥–Ω–∏–∫–æ–≤</i>
üåê <b>PayPal + –∫–∏–≤–∏</b> ‚Äî <i>–≤—ã–≤–æ–¥ –Ω–∞ –∫–∏–≤–∏ ‚Üí –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ PayPal</i>
üì± <b>–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</b> ‚Äî <i>USDT —á–µ—Ä–µ–∑ P2P –Ω–∞ –ì–∞—Ä–∞–Ω—Ç–µ–∫—Å</i>

–í–∞–∂–Ω–æ: –≤—Å–µ —Å–ø–æ—Å–æ–±—ã –ª–µ–≥–∞–ª—å–Ω—ã –ø—Ä–∏ —Å–æ–±–ª—é–¥–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤.

<a href="https://promptbase.com">–û–ø–ª–∞—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å</a>"""
        }
        return fallbacks.get(self.category, fallbacks["–º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è"])
    
    async def get_image(self):
        queries_by_category = {
            "–Ω–æ–≤–∏–Ω–∫–∏": ["new ai tool interface", "technology innovation 2026", "digital breakthrough"],
            "–ø—Ä–∏—ë–º—ã": ["productivity hack", "workflow automation", "smart shortcut"],
            "–∏–Ω—Å–∞–π–¥—ã": ["secret access", "hidden feature", "exclusive technology"],
            "–º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è": ["online income stream", "side hustle laptop", "passive revenue"],
            "–¥–æ—Å—Ç—É–ø": ["global access", "borderless internet", "digital freedom"]
        }
        queries = queries_by_category.get(self.category, ["ai generation interface", "neural network art"])
        query = random.choice(queries)
        
        for attempt in range(2):
            try:
                img = requests.get(
                    "https://api.unsplash.com/photos/random",
                    params={"query": query, "orientation": "landscape", "client_id": self.unsplash_key},
                    timeout=10
                ).json()
                url = img["urls"]["regular"]
                if url.endswith(('.jpg', '.jpeg', '.png', '.webp')):
                    return url
                else:
                    return url.split('?')[0] + "?auto=compress&cs=tinysrgb&w=1200&h=630&fit=crop"
            except:
                continue
        
        fallbacks = [
            "https://images.unsplash.com/photo-1677234558153-bf5ce094bad4?auto=compress&cs=tinysrgb&w=1200&h=630&fit=crop",
            "https://images.unsplash.com/photo-1682978256082-0b97a6a7f77e?auto=compress&cs=tinysrgb&w=1200&h=630&fit=crop",
            "https://images.unsplash.com/photo-1679733087885-28eb46657ffb?auto=compress&cs=tinysrgb&w=1200&h=630&fit=crop"
        ]
        return random.choice(fallbacks)
    
    async def send_to_user(self):
        print(f"üöÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–∞ [{self.category}]: {datetime.now()}")
        
        try:
            reddit_posts = await self.fetch_reddit_posts()
            print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(reddit_posts)} –∫–µ–π—Å–æ–≤")
            
            text = await self.generate_text(reddit_posts)
            print(f"‚úÖ –¢–µ–∫—Å—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω ({len(text)} —Å–∏–º–≤–æ–ª–æ–≤)")
            
            image_url = await self.get_image()
            print(f"üñºÔ∏è –ö–∞—Ä—Ç–∏–Ω–∫–∞: {image_url[:70]}")
            
            # –û–¢–ü–†–ê–í–õ–Ø–ï–ú –¢–û–õ–¨–ö–û –ß–ò–°–¢–´–ô –ü–û–°–¢ ‚Äî –ë–ï–ó –ò–ù–°–¢–†–£–ö–¶–ò–ô, –ë–ï–ó –ú–£–°–û–†–ê –í –ö–û–î–ï
            await self.bot.send_photo(
                chat_id=self.user_id,
                photo=image_url,
                caption=text,
                parse_mode="HTML"
            )
            print(f"‚úÖ –ü–æ—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤–∞–º –≤ –ª–∏—á–∫—É")
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: {e}")
            print(traceback.format_exc())
            try:
                await self.bot.send_message(
                    chat_id=self.user_id,
                    text=self._fallback_post(),
                    parse_mode="HTML"
                )
                print("‚úÖ –§–æ–ª–±—ç–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –ª–∏—á–∫—É")
            except Exception as e2:
                print(f"‚ùå –ü–æ–ª–Ω–∞—è –æ—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: {e2}")

if __name__ == "__main__":
    agent = FreeAITechAgent()
    asyncio.run(agent.send_to_user())